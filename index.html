<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web AR æ¼”ç¤º - GitHub Pages</title>
    
    <!-- å¼•å…¥ A-Frame å’Œ AR.js åº“ -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.min.js"></script>
    
    <style>
        body {
            margin: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        
        .ar-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        
        .ar-controls {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            max-width: 320px;
            backdrop-filter: blur(10px);
        }
        
        .ar-controls h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        
        .ar-controls p {
            margin: 5px 0;
            font-size: 14px;
            line-height: 1.4;
        }
        
        .ar-controls button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .ar-controls button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            z-index: 1000;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }
        
        .status-indicator.found {
            background: rgba(76, 175, 80, 0.9);
        }
        
        .status-indicator.lost {
            background: rgba(244, 67, 54, 0.9);
        }
        
        @media (max-width: 768px) {
            .ar-controls {
                max-width: 280px;
                padding: 12px;
            }
            
            .ar-controls h3 {
                font-size: 16px;
            }
            
            .ar-controls p {
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <!-- æ§åˆ¶é¢æ¿ -->
    <div class="ar-controls">
        <h3>ğŸ¯ Web AR æ¼”ç¤º</h3>
        <p><strong>ä½¿ç”¨æ­¥éª¤ï¼š</strong></p>
        <p>1. å…è®¸æµè§ˆå™¨è®¿é—®æ‘„åƒå¤´</p>
        <p>2. ä¸‹è½½æˆ–æ˜¾ç¤º Hiro æ ‡è®°</p>
        <p>3. å°†æ ‡è®°å¯¹å‡†æ‘„åƒå¤´</p>
        <p>4. è§‚çœ‹ 3D å¯¹è±¡å‡ºç°åœ¨æ ‡è®°ä¸Š</p>
        <button onclick="downloadMarker()">ğŸ“¥ ä¸‹è½½ Hiro æ ‡è®°</button>
    </div>
    
    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="status-indicator" id="statusIndicator">
        ğŸ” æ­£åœ¨æœç´¢ AR æ ‡è®°...
    </div>

    <!-- AR åœºæ™¯ -->
    <div class="ar-container">
        <a-scene 
            embedded 
            arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
            vr-mode-ui="enabled: false"
            gesture-detector>
            
            <!-- AR æ ‡è®°æ£€æµ‹ -->
            <a-marker 
                preset="hiro" 
                id="hiroMarker"
                raycaster="objects: .clickable"
                emitevents="true"
                cursor="fuse: false; rayOrigin: mouse;">
                
                <!-- æ—‹è½¬çš„ç«‹æ–¹ä½“ -->
                <a-box 
                    id="cube1"
                    position="0 0.5 0" 
                    rotation="0 45 0" 
                    color="#4CC3D9" 
                    scale="0.8 0.8 0.8"
                    class="clickable"
                    animation="property: rotation; to: 360 405 0; loop: true; dur: 4000"
                    shadow>
                </a-box>
                
                <!-- æµ®åŠ¨çš„çƒä½“ -->
                <a-sphere 
                    id="sphere1"
                    position="1.5 1 0" 
                    radius="0.4" 
                    color="#FF6B6B" 
                    class="clickable"
                    animation="property: position; to: 1.5 2 0; dir: alternate; dur: 2000; loop: true"
                    shadow>
                </a-sphere>
                
                <!-- æ—‹è½¬çš„åœ†é”¥ä½“ -->
                <a-cone 
                    id="cone1"
                    position="-1.5 0.5 0" 
                    radius-bottom="0.4" 
                    radius-top="0" 
                    height="0.8" 
                    color="#FFC107" 
                    class="clickable"
                    animation="property: rotation; to: 0 360 0; loop: true; dur: 3000"
                    shadow>
                </a-cone>
                
                <!-- åœ°é¢ -->
                <a-plane 
                    position="0 0 0" 
                    rotation="-90 0 0" 
                    width="4" 
                    height="4" 
                    color="#7BC8A4" 
                    opacity="0.3"
                    shadow>
                </a-plane>
                
                <!-- ç¯å¢ƒå…‰ -->
                <a-light type="ambient" color="#404040"></a-light>
                <a-light type="directional" position="0 1 1" color="#ffffff" intensity="0.5" cast-shadow></a-light>
            </a-marker>
            
            <!-- æ‘„åƒå¤´ -->
            <a-entity camera></a-entity>
        </a-scene>
    </div>

    <script>
        // AR åœºæ™¯åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            const scene = document.querySelector('a-scene');
            const marker = document.querySelector('#hiroMarker');
            const statusIndicator = document.getElementById('statusIndicator');
            
            // ç›‘å¬æ ‡è®°æ‰¾åˆ°äº‹ä»¶
            marker.addEventListener('markerFound', () => {
                console.log('âœ… AR æ ‡è®°å·²æ‰¾åˆ°ï¼');
                statusIndicator.textContent = 'ğŸ‰ AR æ ‡è®°å·²è¯†åˆ«';
                statusIndicator.className = 'status-indicator found';
                
                // æ·»åŠ æ‰¾åˆ°æ ‡è®°çš„åŠ¨ç”»æ•ˆæœ
                const objects = marker.querySelectorAll(':not(a-plane)');
                objects.forEach((obj, index) => {
                    setTimeout(() => {
                        obj.setAttribute('animation', `property: scale; to: 1 1 1; dur: 500; easing: easeOutElastic`);
                    }, index * 200);
                });
            });
            
            // ç›‘å¬æ ‡è®°ä¸¢å¤±äº‹ä»¶
            marker.addEventListener('markerLost', () => {
                console.log('âŒ AR æ ‡è®°å·²ä¸¢å¤±');
                statusIndicator.textContent = 'ğŸ” æ­£åœ¨æœç´¢ AR æ ‡è®°...';
                statusIndicator.className = 'status-indicator lost';
            });
            
            // æ·»åŠ ç‚¹å‡»äº¤äº’
            const clickableObjects = document.querySelectorAll('.clickable');
            clickableObjects.forEach(obj => {
                obj.addEventListener('click', () => {
                    // åˆ›å»ºç‚¹å‡»æ•ˆæœ
                    createClickEffect(obj);
                    
                    // æ”¹å˜é¢œè‰²
                    const colors = ['#4CC3D9', '#FF6B6B', '#FFC107', '#9C27B0', '#4CAF50'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    obj.setAttribute('color', randomColor);
                    
                    // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
                    playClickSound();
                });
            });
            
            // æ£€æŸ¥è®¾å¤‡å…¼å®¹æ€§
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                alert('âš ï¸ æ‚¨çš„è®¾å¤‡ä¸æ”¯æŒæ‘„åƒå¤´è®¿é—®ï¼Œæ— æ³•ä½¿ç”¨ AR åŠŸèƒ½');
                statusIndicator.textContent = 'âŒ è®¾å¤‡ä¸æ”¯æŒ';
                statusIndicator.className = 'status-indicator lost';
            }
        });
        
        // åˆ›å»ºç‚¹å‡»æ•ˆæœ
        function createClickEffect(object) {
            const position = object.getAttribute('position');
            const effect = document.createElement('a-sphere');
            effect.setAttribute('position', `${position.x} ${position.y} ${position.z}`);
            effect.setAttribute('radius', '0.1');
            effect.setAttribute('color', '#ffffff');
            effect.setAttribute('opacity', '0.8');
            effect.setAttribute('animation', 'property: scale; to: 3 3 3; dur: 500; easing: easeOutQuad');
            effect.setAttribute('animation__fade', 'property: opacity; to: 0; dur: 500; easing: easeOutQuad');
            
            const marker = document.querySelector('#hiroMarker');
            marker.appendChild(effect);
            
            // ç§»é™¤æ•ˆæœ
            setTimeout(() => {
                marker.removeChild(effect);
            }, 500);
        }
        
        // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
        function playClickSound() {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.1);
                
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.1);
            } catch (e) {
                console.log('éŸ³é¢‘æ’­æ”¾å¤±è´¥:', e);
            }
        }
        
        // ä¸‹è½½ Hiro æ ‡è®°
        function downloadMarker() {
            const link = document.createElement('a');
            link.href = 'https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/hiro.png';
            link.download = 'hiro-marker.png';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // å¤„ç†éŸ³é¢‘ä¸Šä¸‹æ–‡çš„ç”¨æˆ·æ¿€æ´»è¦æ±‚
        document.addEventListener('click', function initAudio() {
            if (typeof AudioContext !== 'undefined' || typeof webkitAudioContext !== 'undefined') {
                const audioContext = new (AudioContext || webkitAudioContext)();
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }
            document.removeEventListener('click', initAudio);
        }, { once: true });
    </script>
</body>
</html>
